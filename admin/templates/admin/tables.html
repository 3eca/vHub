{% extends "main.html" %}
{% block admin_menu %}
<li class="nav-item">
    <button type="button" class="btn btn-outline-light" onclick="window.location.href = '{{ url_for('admin.root') }}' ; ">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-arms-up" viewBox="0 0 16 16">
            <path d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
            <path d="m5.93 6.704-.846 8.451a.768.768 0 0 0 1.523.203l.81-4.865a.59.59 0 0 1 1.165 0l.81 4.865a.768.768 0 0 0 1.523-.203l-.845-8.451A1.5 1.5 0 0 1 10.5 5.5L13 2.284a.796.796 0 0 0-1.239-.998L9.634 3.84a.7.7 0 0 1-.33.235c-.23.074-.665.176-1.304.176-.64 0-1.074-.102-1.305-.176a.7.7 0 0 1-.329-.235L4.239 1.286a.796.796 0 0 0-1.24.998l2.5 3.216c.317.316.475.758.43 1.204Z"/>
        </svg>
        Admin
    </button>
</li>
<li class="nav-item">
    <span>|</span>
</li>
{% if users %}
<li class="nav-item">
    <button type="button" class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#new-user">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-add" viewBox="0 0 16 16">
            <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0m-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
            <path d="M8.256 14a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z"/>
        </svg>
        Add user
    </button>
</li>
{% elif groups %}
<li class="nav-item">
    <button type="button" class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#new-gp">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-file-earmark-plus" viewBox="0 0 16 16">
            <path d="M8 6.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 .5-.5"/>
            <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5z"/>
        </svg>
        Add group
    </button>
</li>
{% elif playlists %}
<li class="nav-item">
    <button type="button" class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#new-gp">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-clipboard-plus" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7"/>
            <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1z"/>
            <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0z"/>
        </svg>
        Add playlist
    </button>
</li>
{% endif %}
{% endblock %}
{% block logout %}
<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
    <li class="nav-item">
        {% if shared_video %}
        <form class="d-flex" action="/admin/shared-video" method="POST">
        {% elif blocked_user %}
        <form class="d-flex" action="/admin/blocked-users" method="POST">
        {% elif all_video %}
        <form class="d-flex" action="/admin/all-video" method="POST">
        {% elif users %}
        <form class="d-flex" action="/admin/users" method="POST">
        {% elif groups %}
        <form class="d-flex" action="/admin/groups" method="POST">
        {% elif playlists %}
        <form class="d-flex" action="/admin/playlists" method="POST">
        {% endif %}
            <input class="form-control" type="search" placeholder="Search" aria-label="Search" name="search">
            <button class="btn btn-outline-light" type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                </svg>
            </button>
        </form>
    </li>
    <li class="nav-item">
        <span>|</span>
    </li>
    <li class="nav-item">
        <button type="button" class="btn btn-outline-light" onclick="window.location.href = '{{ url_for('logout') }}' ; ">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
            </svg>
            Logout
        </button>
    </li>
</ul>
{% endblock %}
{% block admin_tables %}
{% if shared_video %}
<div>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Upload date</th>
                <th scope="col">Expary share</th>
            </tr>
        </thead>
        <tbody>
            {% for video in data %}
            <tr>
              <td><a href="{{ url_for('play_video', link=video.link) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{video.id}}</a></td>
              <td>{{video.name}}</td>
              <td>{{video.date}}</td>
              <td>{{video.expiry_share}}</td>
            </tr>
            {% endfor %}
          </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% for page in data.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                {% if page %}
                    {% if page == data.page %}
                        <li class="page-item">
                            <a class="page-link">
                                {{page}}
                            </a>
                        </li>
                    {% else %}
                    <li class="page-item">
                        {% if search %}
                        <a class="page-link" href="{{ url_for('admin_shared_video', search=search, page=page) }}">{{page}}</a>
                        {% else %}
                        <a class="page-link"  href="{{ url_for('admin_shared_video', page=page) }}">{{page}}</a>
                        {% endif %}
                    </li>
                    {% endif %}
                {% else %}
                    <li class="page-item">
                        <a class="page-link">
                            ...
                        </a>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
        <p>Total: {{data.total}}</p>
      </nav>
</div>
{% elif blocked_user %}
<div>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Email</th>
                <th scope="col">Date Registration</th>
                <th scope="col">Admin</th>
            </tr>
        </thead>
        <tbody>
            {% for user in data %}
            <tr>
              <td><a href="{{ url_for('admin.user', _id=user.id) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{user.id}}</a></td>
              <td>{{user.name}}</td>
              <td>{{user.email}}</td>
              <td>{{user.date}}</td>
              <td>{{user.admin}}</td>
            </tr>
            {% endfor %}
          </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% for page in data.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                {% if page %}
                    {% if page == data.page %}
                        <li class="page-item">
                            <a class="page-link">
                                {{page}}
                            </a>
                        </li>
                    {% else %}
                    <li class="page-item">
                        {% if search %}
                        <a class="page-link" href="{{ url_for('admin.blocked_users', search=search, page=page) }}">{{page}}</a>
                        {% else %}
                        <a class="page-link"  href="{{ url_for('admin.blocked_users', page=page) }}">{{page}}</a>
                        {% endif %}
                    </li>
                    {% endif %}
                {% else %}
                    <li class="page-item">
                        <a class="page-link">
                            ...
                        </a>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
        <p>Total: {{data.total}}</p>
      </nav>
</div>
{% elif all_video %}
<div>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Upload date</th>
                <th scope="col">Group</th>
                <th scope="col">Playlist</th>
                <th scope="col">Owner</th>
            </tr>
        </thead>
        <tbody>
            {% for row in data %}
            <tr>
              <td><a href="{{ url_for('play_video', link=row[3]) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{row[0]}}</a></td>
              <td>{{row[1]}}</td>
              <td>{{row[2]}}</td>
              <td>{{row[4]}}</td>
              <td>{{row[5]}}</td>
              <td>{{row[6]}}</td>
            </tr>
            {% endfor %}
          </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% for page in data.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                {% if page %}
                    {% if page == data.page %}
                        <li class="page-item">
                            <a class="page-link">
                                {{page}}
                            </a>
                        </li>
                    {% else %}
                    <li class="page-item">
                        {% if search %}
                        <a class="page-link" href="{{ url_for('admin.all_video', search=search, page=page) }}">{{page}}</a>
                        {% else %}
                        <a class="page-link"  href="{{ url_for('admin.all_video', page=page) }}">{{page}}</a>
                        {% endif %}
                    </li>
                    {% endif %}
                {% else %}
                    <li class="page-item">
                        <a class="page-link">
                            ...
                        </a>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
        <p>Total: {{data.total}}</p>
      </nav>
</div>
{% elif users %}
<div>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Email</th>
                <th scope="col">Date registration</th>
                <th scope="col">Blocked</th>
                <th scope="col">Admin</th>
                <th scope="col">Videos</th>
                <th scope="col">Groups</th>
                <th scope="col">Playlists</th>
            </tr>
        </thead>
        <tbody>
            {% for user in data %}
            <tr>
              <td><a href="{{ url_for('admin.user', _id=user.id) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{user.id}}</a></td>
              <td>{{user.name}}</td>
              <td>{{user.email}}</td>
              <td>{{user.date}}</td>
              <td>{{user.blocked}}</td>
              <td>{{user.admin}}</td>
              <td>{{user.cv}}</td>
              <td>{{user.cg}}</td>
              <td>{{user.cp}}</td>
            </tr>
            {% endfor %}
          </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% for page in data.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                {% if page %}
                    {% if page == data.page %}
                        <li class="page-item">
                            <a class="page-link">
                                {{page}}
                            </a>
                        </li>
                    {% else %}
                    <li class="page-item">
                        {% if search %}
                            <a class="page-link" href="{{ url_for('admin.users', search=search, page=page) }}">{{page}}</a>
                            {% else %}
                            <a class="page-link" href="{{ url_for('admin.users', page=page) }}">{{page}}</a>
                            {% endif %}
                    </li>
                    {% endif %}
                {% else %}
                    <li class="page-item">
                        <a class="page-link">
                            ...
                        </a>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
        <p>Total: {{data.total}}</p>
      </nav>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var enableCheckbox = document.getElementById('flexCheckDefault');
        var formControl = document.getElementById('password');
        
        enableCheckbox.addEventListener('change', function() {
            formControl.disabled = !this.checked;
        });
    });
</script>
{% elif groups %}
<div>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Users</th>
                <th scope="col">Videos</th>
            </tr>
        </thead>
        <tbody>
            {% for group in data %}
            <tr>
                <td><a href="{{ url_for('group_info', _id=group.id) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{group.id}}</a></td>
                <td>{{group.name}}</td>
                <td>{{group.cu}}</td>
                <td>{{group.cv}}</td>
            </tr>
            {% endfor %}
          </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if data %}
                {% for page in data.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                    {% if page %}
                        {% if page == data.page %}
                            <li class="page-item">
                                <a class="page-link">
                                    {{page}}
                                </a>
                            </li>
                        {% else %}
                        <li class="page-item">
                            {% if search %}
                            <a class="page-link" href="{{ url_for('admin.groups', search=search, page=page) }}">{{page}}</a>
                            {% else %}
                            <a class="page-link" href="{{ url_for('admin.groups', page=page) }}">{{page}}</a>
                            {% endif %}
                        </li>
                        {% endif %}
                    {% else %}
                        <li class="page-item">
                            <a class="page-link">
                                ...
                            </a>
                        </li>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </ul>
        <p>Total: {{data.total}}</p>
    </nav>
</div>
{% elif playlists %}
<div>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Users</th>
                <th scope="col">Videos</th>
            </tr>
        </thead>
        <tbody>
            {% for playlist in data %}
            <tr>
                <td><a href="{{ url_for('playlist_info', _id=playlist.id) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{playlist.id}}</a></td>
                <td>{{playlist.name}}</td>
                <td>{{playlist.cu}}</td>
                <td>{{playlist.cv}}</td>
            </tr>
            {% endfor %}
          </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if data %}
                {% for page in data.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                    {% if page %}
                        {% if page == data.page %}
                            <li class="page-item">
                                <a class="page-link">
                                    {{page}}
                                </a>
                            </li>
                        {% else %}
                        <li class="page-item">
                            {% if search %}
                            <a class="page-link" href="{{ url_for('admin.playlists', search=search, page=page) }}">{{page}}</a>
                            {% else %}
                            <a class="page-link" href="{{ url_for('admin.playlists', page=page) }}">{{page}}</a>
                            {% endif %}
                        </li>
                        {% endif %}
                    {% else %}
                        <li class="page-item">
                            <a class="page-link">
                                ...
                            </a>
                        </li>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </ul>
        <p>Total: {{data.total}}</p>
    </nav>
</div>
{% endif %}
{% endblock %}
{% block admin_modal_add_user %}
<div class="modal fade" id="new-user" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="new-user" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="new-user">Add new user</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="form-floating mb-4">
                    <input type="text" class="form-control form-control-sm fs-4" id="user-name">
                    <label for="user-name" class="form-label">Name</label>
                </div>    
                <div class="form-floating mb-4">                   
                    <input type="email" class="form-control form-control-sm fs-4" id="user-email">
                    <label for="user-email" class="form-label">Email</label>
                    <span style="word-break: break-all;">System will generate a password for the user and send it to email. You can set the password manually.</span>
                </div>
                
                <div class="form-check d-flex justify-content-start mb-4">
                    <input class="form-check-input" type="checkbox" id="flexCheckDefault" onclick="changeState(this)">
                    <label class="form-check-label" for="flexCheckDefault">Set password</label>
                </div>
                <div class="form-floating mb-4">
                    <input type="password" class="form-control form-control-sm fs-4" id="password" disabled>
                    <label for="password" class="form-label">Password</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="userAdd()">Create</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onClick="window.location.href=window.location.href">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block admin_modal_gp %}
<div class="modal fade" id="new-gp" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="new-gp" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="new-gp">{% if groups %}Add new group{% elif playlists %}Add new playlist{% endif %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="form-floating mb-4">
                    <input type="text" class="form-control form-control-lg fs-4" id="gp-name">
                    <label for="gp-name" class="form-label">Name</label>
                </div>
            </div>
            <div class="modal-footer">
                {% if groups %}
                <button type="button" class="btn btn-primary" onclick="groupAdd()">Create</button>
                {% elif playlists %}
                <button type="button" class="btn btn-primary" onclick="playlistAdd()">Create</button>
                {% endif %}
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onClick="window.location.href=window.location.href">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
