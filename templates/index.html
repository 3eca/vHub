{% extends "main.html" %}
{% block menu %}
{% if admin %}
<li class="nav-item">
    <button type="button" class="btn btn-outline-light" onclick="window.location.href = '{{ url_for('admin.root') }}' ; ">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-arms-up" viewBox="0 0 16 16">
            <path d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
            <path d="m5.93 6.704-.846 8.451a.768.768 0 0 0 1.523.203l.81-4.865a.59.59 0 0 1 1.165 0l.81 4.865a.768.768 0 0 0 1.523-.203l-.845-8.451A1.5 1.5 0 0 1 10.5 5.5L13 2.284a.796.796 0 0 0-1.239-.998L9.634 3.84a.7.7 0 0 1-.33.235c-.23.074-.665.176-1.304.176-.64 0-1.074-.102-1.305-.176a.7.7 0 0 1-.329-.235L4.239 1.286a.796.796 0 0 0-1.24.998l2.5 3.216c.317.316.475.758.43 1.204Z"/>
        </svg>
        Admin
    </button>
</li>
<li class="nav-item">
    <span>|</span>
</li>
{% endif %}
{% if admin and not owner %}
<li class="nav-item" data-bs-toggle="modal" data-bs-target="#access-user">
    <button type="button" class="btn btn-outline-light">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-gear" viewBox="0 0 16 16">
            <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m.256 7a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1zm3.63-4.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0"/>
        </svg>
        Access
    </button>
</li>
<li class="nav-item">
    <span>|</span>
</li>
<li class="nav-item">
    <button type="button" class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#edit-user">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
            <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
            <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
        </svg>
        Edit
    </button>
</li>
{% endif %}
{% endblock %}
{% block logout %}
<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
    <li class="nav-item">
        <button type="button" class="btn btn-outline-light" onclick="window.location.href = '{{ url_for('logout') }}' ; ">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
            </svg>
            Logout
        </button>
    </li>
</ul>
{% endblock %}
{% block modal_user_access %}
<div class="modal fade" id="access-user" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="access-user" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="user">Modify access for: {{data.name}}<br>ID: {{data.id}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <p>
                        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAccessGroups" aria-expanded="false" aria-controls="collapseAccessGroups">
                        Groups
                        </button>
                    </p>
                    <div class="collapse" id="collapseAccessGroups">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">ID</th>
                                    <th scope="col">Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for enabled in data.groups.enabled %}
                                {% if enabled[0] != 1 %}
                                <tr>
                                    <td><input class="form-check-input group" type="checkbox" value="group-{{enabled[0]}}" id="flexCheckChecked" checked onclick="changeState(this)"></td>
                                    <td>{{enabled[0]}}</td>
                                    <td>{{enabled[1]}}</td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                                {% for disabled in data.groups.disabled %}
                                {% if disabled[0] != 1 %}
                                <tr>
                                    <td><input class="form-check-input group" type="checkbox" value="group-{{disabled[0]}}" id="flexCheckDefault" onclick="changeState(this)"></td>
                                    <td>{{disabled[0]}}</td>
                                    <td>{{disabled[1]}}</td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <p>
                        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAccessPlaylists" aria-expanded="false" aria-controls="collapseAccessPlaylists">
                        Playlists
                        </button>
                    </p>
                    <div class="collapse" id="collapseAccessPlaylists">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">ID</th>
                                    <th scope="col">Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for enabled in data.playlists.enabled %}
                                {% if enabled[0] != 1 %}
                                <tr>
                                    <td><input class="form-check-input playlist" type="checkbox" value="playlist-{{enabled[0]}}" id="flexCheckChecked" checked onclick="changeState(this)"></td>
                                    <td>{{enabled[0]}}</td>
                                    <td>{{enabled[1]}}</td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                                {% for disabled in data.playlists.disabled %}
                                {% if disabled[0] != 1 %}
                                <tr>
                                    <td><input class="form-check-input playlist" type="checkbox" value="playlist-{{disabled[0]}}" id="flexCheckDefault" onclick="changeState(this)"></td>
                                    <td>{{disabled[0]}}</td>
                                    <td>{{disabled[1]}}</td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="userAccess()">Apply</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onClick="window.location.href=window.location.href">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block modal_user_edit %}
<div class="modal fade" id="edit-user" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="edit-user" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="edit-user" enctype=multipart/form-data>
                <div class="modal-header">
                    <h5 class="modal-title" id="edit-user">Edit user: {{data.name}}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-floating mb-4">
                        <input type="password" class="form-control form-control-sm fs-4" id="password">
                        <label for="password" class="form-label">Password</label>
                        <button type="button" class="btn btn-primary" onclick="setPassword()" style="margin-top: 5px;">Set password</button>
                    </div>
                    <p>
                        <label class="form-label">Generate password and send email</label>
                        <br>
                        <button type="button" class="btn btn-primary" onclick="resetPassword()">Apply</button>
                    </p>
                    <hr/>
                    <div class="row">
                        <div class="col">
                            <label class="form-label">+ Admin</label>
                        </div>
                        <div class="col">
                            <button type="button" class="btn btn-primary" onclick="admin(true)">Apply</button>
                        </div>
                        <div class="col">
                            <label class="form-label">- Admin</label>
                        </div>
                        <div class="col">
                            <button type="button" class="btn btn-primary" onclick="admin(false)">Apply</button>
                        </div>
                    </div>
                    <p></p>
                    <div class="row">
                        <div class="col">
                            <label class="form-label">Block user</label>
                        </div>
                        <div class="col">
                            <button type="button" class="btn btn-primary" onclick="userBlocked(true)">Apply</button>
                        </div>
                        <div class="col">
                            <label class="form-label">Unblock user</label>
                        </div>
                        <div class="col">
                            <button type="button" class="btn btn-primary" onclick="userBlocked(false)">Apply</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onClick="window.location.href=window.location.href">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
{% block index %}
<div class="user-info" id="{{data.id}}">
    <section class="h-100 gradient-custom-2">
        <div class="container py-5 h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col col-lg-9 col-xl-7 flex-grow-1">
                    <div class="card">
                        <div class="rounded-top text-white d-flex flex-row bg-dark">
                            <div class="ms-3" style="margin-top: 50px;">
                                <h1 id="user-name">{{data.name}}</h1>
                                <h5 id="user-email">{{data.email}}</h5>
                            </div>
                        </div>
                        <div class="p-4 text-black" style="background-color: #f8f9fa;">
                            <div class="d-flex justify-content-end text-center py-1">
                                {% if data.admin %}
                                <div class="px-3">
                                    <p class="mb-1 h6">{{data.admin}}</p>
                                    <p class="small text-muted mb-0">Admin</p>
                                </div>
                                {% endif %}
                                <div class="px-3">
                                    <p class="mb-1 h6">{{data.date}}</p>
                                    <p class="small text-muted mb-0">Date registration</p>
                                </div>
                                <div class="px-3">
                                    <p class="mb-1 h6">{{data.blocked}}</p>
                                    <p class="small text-muted mb-0">Blocked</p>
                                </div>
                                <div class="px-3">
                                    <p class="mb-1 h6">{{data.count_videos}}</p>
                                    <p class="small text-muted mb-0">Videos</p>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4 text-black">
                            {% if owner %}
                            <div class="row">
                                <div class="col">
                                    <div class="mb-5">
                                        <button class="btn btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGroups" aria-expanded="false" aria-controls="collapseGroups">Show</button>
                                        <label>My groups</label>
                                        <div class="collapse" id="collapseGroups">
                                            <div class="p-4" style="background-color: #f8f9fa;">
                                                {% if data.user_groups %}
                                                {% for group in data.user_groups %}
                                                <p class="font-italic mb-1">
                                                    <a href="{{ url_for('group_info', _id=group[0]) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{group[1]}}</a>
                                                </p>
                                                {% endfor %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-5">
                                        <button class="btn btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePlaylists" aria-expanded="false" aria-controls="collapsePlaylists">Show</button>
                                        <label>My playlists</label>
                                        <div class="collapse" id="collapsePlaylists">
                                            <div class="p-4" style="background-color: #f8f9fa;">
                                                {% if data.user_playlists %}
                                                {% for playlist in data.user_playlists %}
                                                <p class="font-italic mb-1">
                                                    <a href="{{ url_for('playlist_info', _id=playlist[0]) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{playlist[1]}}</a>
                                                </p>
                                                {% endfor %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="mb-5">
                                        <button class="btn btn-dark" type="button" onclick="window.location.href = '{{ url_for('my_video') }}' ; ">Show</button>
                                        <label>My video</label>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-5">
                                        <button class="btn btn-dark" type="button" onclick="window.location.href = '{{ url_for('available_video') }}' ; ">Show</button>
                                        <label>Available video</label>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            {% if admin and not owner %}
                            <div class="row">
                                <div class="col">
                                    <div class="mb-5">
                                        <button class="btn btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGroups" aria-expanded="false" aria-controls="collapseGroups">Show</button>
                                        <label>User groups</label>
                                        <div class="collapse" id="collapseGroups">
                                            <div class="p-4" style="background-color: #f8f9fa;">
                                                {% if data.user_groups %}
                                                {% for group in data.user_groups %}
                                                <p class="font-italic mb-1">
                                                    <a href="{{ url_for('group_info', _id=group[0]) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{group[1]}}</a>
                                                </p>
                                                {% endfor %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-5">
                                        <button class="btn btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePlaylists" aria-expanded="false" aria-controls="collapsePlaylists">Show</button>
                                        <label>User playlists</label>
                                        <div class="collapse" id="collapsePlaylists">
                                            <div class="p-4" style="background-color: #f8f9fa;">
                                                {% if data.user_playlists %}
                                                {% for playlist in data.user_playlists %}
                                                <p class="font-italic mb-1">
                                                    <a href="{{ url_for('playlist_info', _id=playlist[0]) }}" class="link-dark link-offset-2 link-underline link-underline-opacity-0">{{playlist[1]}}</a>
                                                </p>
                                                {% endfor %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="mb-5">
                                        <button class="btn btn-dark" type="button" onclick="window.location.href = '{{ url_for('admin.user_video', _id=data.id) }}' ; ">Show</button>
                                        <label>User video</label>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}
